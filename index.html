<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Erine in Etherland</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      #gameWrap {
        background: #d6c9b6;
        font-family: "Garamond", serif;
      }
      #gameContainer {
        position: relative;
        width: 100%;
        max-width: 1200px;
        height: 550px;
        margin: auto;
        overflow: hidden;
        background-color: #222;
      }
      canvas {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
      }
      #bgPetir {
        position: absolute;
        width: 100%;
        height: 100%;
        object-fit: cover;
        top: 0;
        left: 0;
        z-index: 0;
      }

      #startBtn {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 5;
        padding: 15px 25px;
        font-size: 18px;
        background: green;
        color: white;
        border: none;
        border-radius: 12px;
      }
      #footer {
        position: absolute;
        bottom: 0;
        width: 100%;
        text-align: center;
        background-color: rgba(0, 0, 0, 0.5);
        color: rgba(238, 255, 0, 1);
        font-family: "Garamond", serif;
        padding: 10px 0;
        font-size: 20px;
        z-index: 10;
      }

      .game-over {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.75);
        z-index: 10;
        color: white;
        text-align: center;
        padding-top: 80px;
      }
      .game-over img {
        width: 120px;
        height: auto;
        margin-bottom: 20px;
        border-radius: 12px;
      }
      .game-over h1 {
        font-size: 28px;
        margin-bottom: 10px;
      }
      .game-over p {
        font-size: 22px;
        margin-bottom: 20px;
      }
      .game-over button {
        font-size: 16px;
        padding: 10px 20px;
        background: #00c853;
        border: none;
        color: white;
        border-radius: 6px;
        cursor: pointer;
      }
      #pointDisplay {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 18px;
        color: white;
        z-index: 5;
        background-color: rgba(0, 0, 0, 0.5);
        padding: 6px 12px;
        border-radius: 8px;
      }
      #volumeControl {
        position: absolute;
        top: 10px;
        left: 10px;
        color: white;
        font-size: 14px;
        z-index: 5;
        background-color: rgba(0, 0, 0, 0.5);
        padding: 6px 12px;
        border-radius: 8px;
      }
      .controls {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 80px;
        z-index: 5;
      }

      .btn {
        padding: 16px 20px; /* bisa dikecilkan jika pakai gambar */
        font-size: 22px; /* untuk teks, bisa diabaikan jika gambar */
        background: #c5b2a1;
        border: none;
        border-radius: 8px;
        cursor: pointer;
      }

      .control-btn {
        -webkit-user-select: none;
        user-select: none;
        touch-action: manipulation;
      }

      /* Untuk gambar 80x80 */
      .control-btn img {
        width: 20px;
        height: 20px;
        display: block;
      }

      @media (max-width: 768px) {
        #gameContainer {
          aspect-ratio: 16 / 10;
        }
        .controls {
          gap: 20px;
          bottom: 5px;
        }
        .btn {
          padding: 10px 14px;
          font-size: 18px;
        }
        #startBtn {
          font-size: 14px;
          padding: 10px 16px;
        }
        .game-over img {
          width: 80px;
        }
        .game-over h1 {
          font-size: 20px;
        }
        .game-over p {
          font-size: 16px;
        }
      }
    </style>
  </head>
  <body>
    <div id="gameContainer">
      <img
        id="bgPetir"
        src="https://cavallery.id/wp-content/uploads/2025/08/langit-e1755426353317.png"
        alt="Background"
      />
      <canvas id="game" width="1200" height="550"></canvas>

      <div class="controls">
        <button class="btn control-btn" data-key="ArrowLeft">
          <img
            src="https://cavallery.id/wp-content/uploads/2025/08/left.png"
            alt="Left"
          />
        </button>
        <button class="btn control-btn" data-key="ArrowUp">
          <img
            src="https://cavallery.id/wp-content/uploads/2025/08/up.png"
            alt="Up"
          />
        </button>
        <button class="btn control-btn" data-key="ArrowRight">
          <img
            src="https://cavallery.id/wp-content/uploads/2025/08/right.png"
            alt="Right"
          />
        </button>
      </div>

      <div id="startScreen">
        <button id="startBtn" onclick="startGame()">Mulai Game</button>
      </div>
      <footer id="footer">Cavallery.id | Erine in Etherland</footer>

      <!-- Game Over -->
      <div class="game-over" id="gameOverScreen">
        <img
          id="gameOverImage"
          src="https://cavallery.id/wp-content/uploads/2025/07/erine-50.gif"
          alt="Game Over"
        />
        <h1
          id="gameOverTitle"
          style="
            color: white !important;
            font-size: 28px !important;
            margin-bottom: 10px;
          "
        >
          Game Over!
        </h1>
        <p
          id="gameOverReason"
          style="
            color: white !important;
            font-size: 22px !important;
            margin-bottom: 20px;
          "
        >
          Kamu diserang zombie!
        </p>
        <button
          onclick="location.reload()"
          style="
            font-size: 16px;
            padding: 10px 20px;
            background: #00c853;
            border: none;
            color: white;
            border-radius: 6px;
            cursor: pointer;
          "
        >
          Main Lagi
        </button>
      </div>

      <div id="pointDisplay">Point: <span id="pointValue">0</span></div>

      <div id="volumeControl">
        Volume:
        <input
          type="range"
          min="0"
          max="1"
          step="0.01"
          value="1"
          id="volumeSlider"
        />
      </div>

      <!-- Audio -->
      <audio id="horseRun" preload="auto" loop>
        <source
          src="https://cavallery.id/wp-content/uploads/2025/07/sound-kuda-mp3cut.net_.mp3"
          type="audio/mpeg"
        />
        <audio id="gameover" preload="auto">
          <source
            src="https://cavallery.id/wp-content/uploads/2025/07/gagal.mp3"
            type="audio/mpeg"
          />
        </audio>
        <audio id="victory" preload="auto">
          <source
            src="https://cavallery.id/wp-content/uploads/2025/07/menang.mp3"
            type="audio/mpeg"
          />
        </audio>
      </audio>
      <audio id="jumpSound" preload="auto">
        <source
          src="https://cavallery.id/wp-content/uploads/2025/07/kuda-lompat.mp3"
          type="audio/mpeg"
        />
      </audio>
      <audio id="point" preload="auto">
        <source
          src="https://cavallery.id/wp-content/uploads/2025/07/point-cava.mp3"
          type="audio/mpeg"
        />
      </audio>
      <audio id="backsound" preload="auto" loop>
        <source
          src="https://cavallery.id/wp-content/uploads/2025/07/backsound-game-ratu-erine.mp3"
          type="audio/mpeg"
        />
      </audio>
    </div>

    <script>
      const horseRunSound = document.getElementById("horseRun");
      const jumpSound = document.getElementById("jumpSound");
      const backsound = document.getElementById("backsound");
      const point = document.getElementById("point");
      const volumeSlider = document.getElementById("volumeSlider");
      const gameoverSound = document.getElementById("gameover");
      const victorySound = document.getElementById("victory");

      volumeSlider.addEventListener("input", () => {
        const vol = parseFloat(volumeSlider.value);
        horseRunSound.volume = vol;
        jumpSound.volume = vol;
        backsound.volume = vol * 0.3;
        point.volume = Math.min(1.0, vol * 2);
      });

      const gameOverScreen = document.getElementById("gameOverScreen");
      const gameOverTitle = document.getElementById("gameOverTitle");
      const gameOverReason = document.getElementById("gameOverReason");
      const gameOverImage = document.getElementById("gameOverImage");
      const canvas = document.getElementById("game");
      const ctx = canvas.getContext("2d");
      const pointValueEl = document.getElementById("pointValue");

      let pointValue = 0;
      const groundHeight = 40;
      const groundY = canvas.height - groundHeight; // posisi tanah di bawah
      const gravity = 0.5;
      const jumpPower = -12;
      const keys = {};
      let frameCounter = 0;
      let cameraX = 0;
      let gameStarted = false;
      let isGameOver = false;
      let playerHitZombie = false;

      const player = {
        x: 100,
        y: groundY - 80,
        width: 64,
        height: 80,
        dy: 0,
        onGround: true,
        facing: "right",
        moving: false,
      };

      const runFrames = [
        "https://cavallery.id/wp-content/uploads/2025/08/erine1.png",
        "https://cavallery.id/wp-content/uploads/2025/08/erine2.png",
        "https://cavallery.id/wp-content/uploads/2025/08/erine3.png",
        "https://cavallery.id/wp-content/uploads/2025/08/erine4.png",
        "https://cavallery.id/wp-content/uploads/2025/08/erine5.png",
        "https://cavallery.id/wp-content/uploads/2025/08/erine6.png",
        "https://cavallery.id/wp-content/uploads/2025/08/erine7.png",
      ];
      const jumpFrames = [
        "https://cavallery.id/wp-content/uploads/2025/08/erine8.png",
      ];
      const idleFrame =
        "https://cavallery.id/wp-content/uploads/2025/08/erine9.png";
      const dizzyFrame =
        "https://cavallery.id/wp-content/uploads/2025/08/erine10.png";
      const gameOverGif =
        "https://cavallery.id/wp-content/uploads/2025/07/erine-50.gif";
      const winImage =
        "https://cavallery.id/wp-content/uploads/2025/07/erine-20.gif";
      const cavalleryImage =
        "https://cavallery.id/wp-content/uploads/2025/07/cavallery.png";
      const zombieFrames = [
        "https://cavallery.id/wp-content/uploads/2025/08/jombierine1.png",
        "https://cavallery.id/wp-content/uploads/2025/08/jombierine2.png",
        "https://cavallery.id/wp-content/uploads/2025/08/jombierine3.png",
        "https://cavallery.id/wp-content/uploads/2025/08/jombierine4.png",
      ];

      const spriteImages = {};
      const imagesToLoad = [
        ...runFrames,
        ...jumpFrames,
        idleFrame,
        winImage,
        cavalleryImage,
        "castle.png",
        dizzyFrame,
        ...zombieFrames,
      ];

      imagesToLoad.forEach((src) => {
        const img = new Image();
        img.src = src;
        img.onload = () => {
          spriteImages[src] = img;
        };
      });

      // tanah dengan jurang
      const groundSegments = [];
      const holePositions = [1000, 1500, 2000, 2800, 3500];
      for (let i = 0; i < 10000; i += 100) {
        if (!holePositions.includes(i))
          groundSegments.push({ x: i, y: groundY, width: 100 });
      }

      // platform
      const platforms = [];
      let lastPlatformX = 600;

      while (lastPlatformX < 7500) {
        const gap = 350 + Math.floor(Math.random() * 150);
        const offsetY = Math.floor(Math.random() * 120);
        const yPos = groundY - 50 - offsetY;
        platforms.push({ x: lastPlatformX, y: yPos, width: 100 });
        lastPlatformX += gap;
      }

      // points
      const totalPoints = 18;
      const points = [];
      for (let i = 0; i < totalPoints; i++) {
        const p = platforms[i % platforms.length];
        points.push({
          x: p.x + p.width / 2 - 16,
          y: p.y - 40,
          width: 32,
          height: 32,
          collected: false,
        });
      }

      // zombies
      const zombies = [];
      for (let i = 1200; i < 7600; i += 1000) {
        zombies.push({
          x: i,
          y: groundY - 64,
          width: 64,
          height: 64,
          speed: 0.3,
          direction: 1,
          minX: i - 100,
          maxX: i + 100,
        });
      }

      // castle
      const castle = {
        x: 8000,
        y: groundY - 360,
        width: 450,
        height: 360,
      };

      function gameOver(reason, win = false) {
        isGameOver = true;
        horseRunSound.pause();
        backsound.pause();
        gameOverScreen.style.display = "block";
        if (win) {
          gameOverTitle.innerText = "Kemenangan!";
          gameOverReason.innerText =
            "Selamat! Ratu Erine sudah sampai di istana Cavallery!";
          gameOverImage.src = winImage;
          victorySound.currentTime = 0;
          victorySound.play().catch(() => {});
        } else {
          gameOverTitle.innerText = "Game Over!";
          gameOverReason.innerText = reason;
          gameOverImage.src = gameOverGif;
          gameoverSound.currentTime = 0;
          gameoverSound.play().catch(() => {});
        }
      }

      function startGame() {
        if (gameStarted) return;
        gameStarted = true;
        const startBtn = document.getElementById("startBtn");
        if (startBtn) startBtn.style.display = "none";
        const footer = document.getElementById("footer");
        if (footer) footer.style.display = "none";
        if (typeof backsound !== "undefined" && backsound.play) {
          backsound.play().catch(() => {});
        }
        loop();
      }

      function update() {
        if (isGameOver) return;
        player.moving = false;

        if (keys["ArrowRight"] || keys["d"]) {
          player.x += 4;
          player.facing = "right";
          player.moving = true;
        }
        if (keys["ArrowLeft"] || keys["a"]) {
          player.x -= 4;
          player.facing = "left";
          player.moving = true;
        }
        if ((keys["ArrowUp"] || keys["w"] || keys[" "]) && player.onGround) {
          player.dy = jumpPower;
          player.onGround = false;
          jumpSound.currentTime = 0;
          jumpSound.play().catch(() => {});
        }

        if (player.moving && player.onGround && !isGameOver) {
          if (horseRunSound.paused) horseRunSound.play().catch(() => {});
        } else {
          horseRunSound.pause();
          horseRunSound.currentTime = 0;
        }

        player.dy += gravity;
        player.y += player.dy;
        player.onGround = false;

        [...groundSegments, ...platforms].forEach((seg) => {
          const standing =
            player.x + player.width > seg.x &&
            player.x < seg.x + seg.width &&
            Math.abs(player.y + player.height - seg.y) <= 10 &&
            player.dy >= 0;
          if (standing) {
            player.y = seg.y - player.height;
            player.dy = 0;
            player.onGround = true;
          }
        });

        zombies.forEach((z) => {
          z.x += z.speed * z.direction;
          if (z.x < z.minX || z.x > z.maxX) z.direction *= -1;
        });

        zombies.forEach((z) => {
          const h =
            player.x + player.width > z.x + 10 && player.x < z.x + z.width - 10;
          const v =
            player.y + player.height > z.y + 20 && player.y < z.y + z.height;
          const fromTop = player.dy > 0 && player.y + player.height - z.y < 15;
          if (h && v && !fromTop) {
            playerHitZombie = true;
            gameOver("Ratu Erine Diserang Zombie!");
          }
        });

        points.forEach((pt) => {
          if (
            !pt.collected &&
            player.x < pt.x + pt.width &&
            player.x + player.width > pt.x &&
            player.y < pt.y + pt.height &&
            player.y + player.height > pt.y
          ) {
            pt.collected = true;
            pointValue++;
            pointValueEl.innerText = pointValue;
            point.currentTime = 0;
            point.play().catch(() => {});
          }
        });

        if (!player.onGround && player.y > canvas.height) {
          gameOver("Ratu Erine Jatuh ke Jurang!");
        }

        if (
          player.x + player.width > castle.x &&
          player.y + player.height >= groundY
        ) {
          gameOver("Menang!", true);
        }

        cameraX = player.x - 100;
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save();
        ctx.translate(-cameraX, 0);

        // tanah
        groundSegments.forEach((g) => {
          ctx.fillStyle = "#4b2e18";
          ctx.fillRect(g.x, g.y, g.width, groundHeight);
        });

        // platform
        platforms.forEach((p) => {
          ctx.fillStyle = "#6e4f2a";
          ctx.fillRect(p.x, p.y, p.width, 15);
        });

        // point
        points.forEach((pt) => {
          if (!pt.collected) {
            ctx.drawImage(
              spriteImages[cavalleryImage],
              pt.x,
              pt.y,
              pt.width,
              pt.height
            );
          }
        });

        // zombie
        zombies.forEach((z, i) => {
          const frame =
            zombieFrames[
              Math.floor(frameCounter / 8 + i) % zombieFrames.length
            ];
          ctx.save();
          if (z.direction === -1) {
            ctx.scale(-1, 1);
            ctx.drawImage(
              spriteImages[frame],
              -z.x - z.width,
              z.y,
              z.width,
              z.height
            );
          } else {
            ctx.drawImage(spriteImages[frame], z.x, z.y, z.width, z.height);
          }
          ctx.restore();
        });

        // castle
        ctx.drawImage(
          spriteImages["castle.png"],
          castle.x,
          castle.y,
          castle.width,
          castle.height
        );

        // player
        let frameToDraw = spriteImages[idleFrame];
        if (playerHitZombie) frameToDraw = spriteImages[dizzyFrame];
        else if (!player.onGround) frameToDraw = spriteImages[jumpFrames[0]];
        else if (player.moving) {
          frameToDraw =
            spriteImages[
              runFrames[Math.floor(frameCounter / 6) % runFrames.length]
            ];
        }

        ctx.save();
        if (player.facing === "left") {
          ctx.scale(-1, 1);
          ctx.drawImage(
            frameToDraw,
            -player.x - player.width,
            player.y,
            player.width,
            player.height
          );
        } else {
          ctx.drawImage(
            frameToDraw,
            player.x,
            player.y,
            player.width,
            player.height
          );
        }
        ctx.restore();

        ctx.restore();
        frameCounter++;
      }

      function loop() {
        update();
        draw();
        if (!isGameOver) requestAnimationFrame(loop);
      }

      document.addEventListener("keydown", (e) => (keys[e.key] = true));
      document.addEventListener("keyup", (e) => (keys[e.key] = false));

      function simulateKey(key, isPressed) {
        keys[key] = isPressed;
      }
      document.querySelectorAll(".control-btn").forEach((btn) => {
        const key = btn.dataset.key;
        btn.addEventListener("touchstart", (e) => {
          e.preventDefault();
          simulateKey(key, true);
        });
        btn.addEventListener("touchend", (e) => {
          e.preventDefault();
          simulateKey(key, false);
        });
      });
    </script>
  </body>
</html>
